# Knokko's Custom Items

This is the source code for the Knokko's Custom Items minecraft plug-in: https://dev.bukkit.org/projects/custom-items-and-textures
This plug-in makes it possible to add custom items with their own textures, without sacrificing existing minecraft items. 
(At least, if the (server) resourcepack is used.)

## How the custom texture system works
Normally, resourcepacks are used to change the textures of regular minecraft items to something that looks better. 
However, modern minecraft versions have resourcepack predicates, which make it possible to only assign custom textures to items
*under the right circumstances*. One of these predicates allows the resourcepack to base its decision on whether the item stack
to be shown is *unbreakable* or has lost *durability*. The resourcepacks generated by the *Editor* will assign different textures
to item stacks that have lost durability, but are unbreakable. Such items clearly can't be obtained legitimately (players can't even
obtain unbreakable items, let alone unbreakable items that lost durability). But, the plug-in can construct such items via the Bukkit
API, which is how it will spawn such custom items in-game. The system described here is used to achieve the custom textures. The rest
of the custom item features is not so special.

## Repository structure
This repository is split into several modules:

### bit-helper
The bit-helper module is a small library of mine that is used for compact binary (de)serialization. When I started this plug-in, I thought it
was a good idea to use this, but I am starting to see the its limitations. Nevertheless, it is very stable (has been used in production for more 
than 2 years without any failures) and its results are still quite good (although they could be improved).

### core-plugin-12
This module is the source code of the KnokkoCore plug-in for minecraft 1.12.2. When I started this custom items plug-in, my plan was to use this 
core plug-in as a library to include functionality shared by this custom items plug-in and my future plug-ins. However, I have been too busy with 
this custom items plug-in to start a new one, so this custom items plug-in is the only one that depends on this core plug-in... 
But, I did find another use case for this core plug-in: To achieve some things, I need a different implementation for each minecraft version. So
when the custom items plug-in needs such functionality, it calls the function provided by this core plug-in. If the minecraft version is 1.12.2,
this will work well. If not, the server admin needs to install a different version of my core-plugin. These other versions expose the exact same
API, but handle a different minecraft version. This trick allows the custom items plug-in to work on any minecraft version, as long as the right
version of the core plug-in (also known as KnokkoCore) is installed.

### editor
This module is the source code for *the Editor*. This is a GUI application that users must use to configure the plug-in. The users must download it
and run it on their computer. Using this GUI, they can configure their custom items (choose their textures, attack damage, display name, and
lots of other stuff...). This application also has *Export* buttons that will generate a binary configuration file and a resourcepack. The
configuration file must be uploaded to the server, the resourcepack must be uploaded to some static page host, and the resourcepack-url in the
server.properties must point to that static page host.

### gui
This module is a small gui library that I made a couple of years ago. When I started this custom items plug-in, I thought it was a good idea to use
this library to write the Editor. Recently, I started seeing the limitations of this library: the scale of everything is based on the size of the
window. This has the benefit that the editor will look the same to everyone, regardless of their screen resolution (try resizing your window to
see what I mean), but has the drawback that this can cause distortion of text and images. Also, it lacks many interesting features that would have
avoided the need of implementing all views myself. Switching to a different GUI library might be a good idea, but I am not so sure the amount of
work is worth it.

### plug-in
This module is the source code of the custom items plug-in itself. The plug-in essentially finds the binary configuration file generated by the
Editor, deserializes it, and makes sure that everything configured in the Editor actually happens in-game.

### safe-gui-tester
This is a small module that helps with the automatic test of the Editor. The automatic test of the Editor can be found in 
`editor/src/test/java/nl/knokko/customitems/editor/test/EditorTester.java`. This is not a proper unit test, but more like an integration test. It
can be started by running this main class. It will open the Editor and test it by taking control over the mouse and trying lots of stuff. Because
this can be problematic if it goes inside an endless loop and keeps controlling the mouse, you can stop it at any time by pressing the X key on
your keyboard. This module adds that X safety feature. I am also seeing that this way of testing is probably not the best way to go, so I stopped
writing tests like this. But, the old tests before I realized this are still usable and occasionally catch problems.

### shared-code
This module contains the code that is used by both the Editor and the plug-in.

## Development
### Getting started
#### BuildTools
Before you can compile this project, you will need to get BuildTools from https://www.spigotmc.org/wiki/buildtools/ and then run
`java -jar BuildTools.jar --rev 1.12.2` with *really 1.12.2*, regardless of the minecraft version you are interested in: The custom items plug-in
is always compiled against craftbukkit 1.12.2 (it can also be used on later versions, don't worry, but it had to be compiled against *some* version
and this version is safest because it has the least features). Due to some juridical conflict, it is illegal to publish the entire craftbukkit jar,
but it is legal to build it on your own computer using BuildTools...

#### IDE
You will probably want to use an IDE to work on this project. Regardless of your IDE, you should first clone, fork, or download this project as a
ZIP file. If you downloaded it as a ZIP file, you also need to extract it. Then, you should open it in an IDE. For *Eclipse*, use File -> Import ->
Gradle -> Existing Gradle Project -> Navigate file explorer to wherever you downloaded this project to and click on the root folder (normally
`custom-items`). This might take a while the first time, so have some patience. For *Intellij*, use File -> Open... -> Navigate file explorer to
wherever you downloaded this project and click on the root folder (normally `custom-items`). Then it should start doing all kinds of Gradle stuff
on the background, and you should wait for that to complete. It may happen that Intellij won't recognize imports yet after this step (this happens
on my computer). You can fix it by restarting Intellij.

#### Deployment
For production deployment, make sure you are using Java 8! This is necessary because most minecraft server hosts don't like updating and only
accept plug-ins compiled against Java 8. Also, since Java doesn't have JREs for Java 9+, you will probably want to compile the Editor with
Java 8 (unless you take the effort to use something like jlink to create a native executable for every single operating system).
Also, you might want to run `./gradlew test` or `gradlew test` (to do a couple of quick automatic tests) before deploying.
To deploy, you need to run `./gradlew shadowJar` or `gradlew shadowJar` (which one to use depends on your operating system). The Editor should
be put in `editor/build/libs/editor-all.jar`, the custom items plug-in should be put in `plug-in/build/libs/plug-in-all.jar`, and the KnokkoCore
plug-in for minecraft 1.12.2 should be put in `core-plug-in/build/libs/core-plug-in-12-all.jar`. Different versions of KnokkoCore are another story...
You can find their source code at https://github.com/knokko/Core-Plugin-1.14 but that doesn't have a nice Gradle setup yet... Also note that the
code for mc 1.14 is in the master branch and the other mc versions have their own branch.
